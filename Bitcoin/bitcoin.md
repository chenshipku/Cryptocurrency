# 比特币运行机制

此文参照视频 [How Bitcoin Works Under the Hood](https://www.youtube.com/watch?v=Lx9zgZCMqXE).

## 什么是比特币

比特币是一个去中心化的账本存储系统。账本中记录了所有比特币转账信息，所有加入比特币网络的电脑上，都会存储一份这样的账本。
由于去中心化储存的特点，当某一个节点处理了一笔转账之后，需要将处理的情况广播给临近的其他节点，直至网络上所有节点的账本信息都被更新。

## 交易授权

我们使用密码或者签名来对银行卡交易进行授权。比特币利用公钥+私钥进行授权，其中公钥相当于公开的收款账号，秘钥则相当于密码。
比特币系统让每个参与交易的人，先随机生成一个字符串作为私钥，然后通过私钥生成唯一对应的公钥。由于非对称加密的特点，人们无法通过公钥推知私钥信息。
当Alice给Bob转5个BTC时，会使用Alice的私钥解锁她的5个BTC，然后用Bob的公钥将其锁定。之后这5个BTC便只能通过Bob的私钥才能解锁转移。
具体到比特币交易的数据结构，包括：
* inputs:

  * txn1：标记1，与涉及这笔比特币的上次交易的标记2相同。通过txn**可追溯**到这笔比特币的流通历史。

  * ScriptSig：Alice私钥的Hash值，用于解锁。

* outputs:

  * txn2：标记2，与涉及这笔比特币的下次交易的标记1相同。

  * Amount：金额

  * ScriptPubKey：用Bob公钥生成的锁定脚本

Alice使用比特币时，比特币系统会先通过txn1找到涉及这笔比特币的上次交易，作两个验证，
一是验证上次交易的ScriptPubKey与这次交易的ScriptSig是否相匹配，二是验证这次交易的input是否在未被支付交易的索引中。
这两项验证之后，Alice才可以使用这笔比特币。
以上只是最简单的情况，实际上可能Alice使用的5个比特币来源于之前的两笔交易，那么inputs里面就有txn11,txn12。

## 篡改交易

比特币系统中只有如上所述的交易记录，每个账户（公钥）名下的余额是将这个公钥下的所有转入转出加和得到。所以要篡改余额，需要篡改交易。
比特币系统的交易数据存储方式是区块链。交易发生后先在计算机内存中进行验证，验证通过后会作为未确认交易放在有效交易池中等待被装到区块里。
矿工节点
